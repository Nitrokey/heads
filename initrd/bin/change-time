#!/bin/bash
#change time using hwclock and date -s

clear

echo -e -n "Please enter the date and time you wish to set\n"
echo -e -n "enter the year please (2024-2200) (enter for 2024)\n"
read -n 4 year
echo -e "\n"

#if enter
if [[ $year = "" ]]; then 
    year=2024    
fi

#must be a 4 digits number between 2024 and 2200
while [[ ! $year =~ ^[0-9]{4} ]] || [[ ${year#0} -lt 2024 ]] || [[ ${year#0} -gt 2200 ]]; 
do    
    echo -e -n "wrong year, you enter "$year" please enter it again (2024-2200) (enter for 2024) \n"
    read -n 4 year
    echo -e "\n"
    if [[ $year = "" ]]; then 
        year=2024    
    fi
done

echo -e -n "enter the month please (01-12) (enter for 01)\n"
read -n 2 month
echo -e "\n"

if [[ $month = "" ]]; then 
    month=01    
fi

#must be a 2 digits number between 01 and 12
while  [[ ! $month =~ ^[0-9]{2} ]] || [[ ${month#0} -lt 1 ]] || [[ ${month#0} -gt 12 ]] ; 
do    
    echo -e -n "wrong month, you enter "$month" please enter it again (01-12) (enter for 01) \n"
    read -n 2 month
    echo -e "\n"
    if [[ $month = "" ]]; then 
        month=01    
    fi
done

echo -e -n "enter the day please (01-31) (enter for 01)\n"
read -n 2 day
echo -e "\n"

if [[ $day = "" ]]; then 
    day=01    
fi

#must be a 2 digits number between 01 and 31
while  [[ ! $day =~ ^[0-9]{2} ]] || [[ ${day#0} -lt 1 ]] || [[ ${day#0} -gt 31 ]] ; 
do   
    echo -e -n "wrong day, you enter "$day" please enter it again (01-31) (enter for 01) \n"
    read -n 2 day
    echo -e "\n"
    if [[ $day = "" ]]; then 
        day=01    
    fi
done

echo -e -n "enter the hour please (00-23) (enter for 00)\n"
read -n 2 hour
echo -e "\n"

if [[ $hour = "" ]]; then 
    hour=00  
fi

#must be a 2 digits number between 00 and 23
while  [[ ! $hour =~ ^[0-9]{2} ]] || [[ ${hour#0} -lt 0 ]] || [[ ${hour#0} -gt 23 ]] ; 
do    
    echo -e -n "wrong hour, you enter "$hour" please enter it again (00-23) (enter for 00) \n"
    read -n 2 hour
    echo -e "\n"
    if [[ $hour = "" ]]; then 
        hour=00  
    fi
done

echo -e -n "enter minute please (00-59) (enter for 00)\n"
read -n 2 min
echo -e "\n"

if [[ $min = "" ]]; then 
    min=00    
fi

#must be a 2 digits number between 00 and 59
while  [[ ! $min =~ ^[0-9]{2} ]] || [[ ${min#0}  -lt 0 ]] || [[ ${min#0}  -gt 59 ]]  ; 
do    
    echo -e -n "wrong min, you enter "$min" please enter it again (00-59) (enter for 00) \n"
    read -n 2 min
    echo -e "\n"
    if [[ $min = "" ]]; then 
        min=00    
    fi
done

echo -e -n "enter second please (00-59) (enter for 00)\n"
read -n 2 sec
echo -e "\n"

if [[ $sec = "" ]]; then 
    sec=00    
fi

#must be a 2 digits number between 00 and 59
while  [[ ! $sec =~ ^[0-9]{2} ]] || [[ ${sec#0}  -lt 0 ]] || [[ ${sec#0} -gt 59 ]] ; 
do    
    echo -e -n "wrong sec, you enter "$sec" please enter it again (00-59) (enter for 00) \n"
    read -n 2 sec
    echo -e "\n"
    if [[ $sec = "" ]]; then 
        sec=00    
    fi
done

##getting the output of date -s 
OUTPUT=$(date -s "$year-$month-$day $hour:$min:$sec" 2>&1)

##if output is starting with the letter d which is the beginning of the error message then we do the script again 
if [[ ${OUTPUT} == d* ]]; then
    echo "The date is not correct, press any key to set it again"
    echo -e "\n"
    read -n 1 noting
    clear
    change-time
else
    hwclock -w
    echo -e "the date as been sucessfully set to $year-$month-$day $hour:$min:$sec"
    echo -e "\n"

    echo -e "press any key to return to the menu"
    echo -e "\n"
    read -n 1 nothing
fi
