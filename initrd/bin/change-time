#!/bin/bash
#change time using hwclock and date -s

clear

echo -e -n "Please enter the date and time you wish to set\n"

date () {
    echo -e -n "enter the $1 please (2024-2200) (enter for 2024)\n"
    read -n $4 value
    echo -e "\n"
    #if enter
    if [[ $value = "" ]]; then 
        value=$2    
    fi

    #must be a 4 digits number between 2024 and 2200
    while [[ ! $value =~ ^[0-9]{$4} ]] || [[ ${value#0} -lt $2 ]] || [[ ${value#0} -gt $3 ]]; 
    do    
        echo -e -n "wrong $1, you enter "$value" please enter it again, must be a $4 digits number between $2 and $3 (press enter for $2) \n"
        read -n $4 value
        echo -e "\n"
        if [[ $value = "" ]]; then 
            value=$2    
        fi
    done    
}

date "year" "2024" "2200" "4"
date "month" "01" "12" "2"
date "day" "01" "31" "2"
date "hour" "00" "23" "2"
date "min" "00" "59" "2"
date "sec" "00" "59" "2"

##getting the output of date -s 
OUTPUT=$(date -s "$year-$month-$day $hour:$min:$sec" 2>&1)

##if output is starting with the letter d which is the beginning of the error message then we do the script again 
if [[ ${OUTPUT} == d* ]]; then
    echo "The date is not correct, press any key to set it again"
    echo -e "\n"
    read -n 1 noting
    clear
    change-time
else
    hwclock -w
    echo -e "the date as been sucessfully set to $year-$month-$day $hour:$min:$sec"
    echo -e "\n"

    echo -e "press any key to return to the menu"
    echo -e "\n"
    read -n 1 nothing
fi
